import u,{createContext,useReducer,useEffect,useContext,useState,useRef}from'react';import {useDisclosure,Modal,ModalContent,ModalHeader,ModalBody,ModalFooter}from'@nextui-org/modal';import {motion,AnimatePresence}from'framer-motion';import {Button}from'@nextui-org/button';import {Tabs,Tab}from'@nextui-org/tabs';import {CalendarDaysIcon,Calendar,ArrowLeft,ArrowRight,TrashIcon}from'lucide-react';import {BsCalendarWeek,BsCalendarMonth}from'react-icons/bs';import {Input,Textarea}from'@nextui-org/input';import {Select,SelectItem}from'@nextui-org/select';import {Dropdown,DropdownTrigger,DropdownMenu,DropdownItem}from'@nextui-org/dropdown';import {parseDate,Time}from'@internationalized/date';import {DateRangePicker}from'@nextui-org/date-picker';import {TimeInput}from'@nextui-org/date-input';import {useForm}from'react-hook-form';import {zodResolver}from'@hookform/resolvers/zod';import {z as z$1}from'zod';import {v4}from'uuid';import {Chip}from'@nextui-org/chip';import {Card}from'@nextui-org/card';import ke from'clsx';var ue=createContext(void 0),ce=({children:t})=>{let[o,c]=useState(null),[s,a]=useState(null),{isOpen:p,onOpen:l,onClose:y}=useDisclosure(),m=async({title:C,body:w,footer:N,modalClassName:D,getter:A})=>{if(c({title:C,body:w,footer:N,modalClassName:D}),A)try{let k=await A();a(k);}catch(k){console.error("Error fetching data:",k),a(null);}else a(null);l();};return u.createElement(ue.Provider,{value:{showModal:m,onClose:y,data:s}},t,u.createElement(Modal,{backdrop:"blur",classNames:{backdrop:"max-h-screen overflow-hidden",wrapper:"max-h-screen overflow-hidden"},isOpen:p,onOpenChange:y},u.createElement(ModalContent,{className:o?.modalClassName||""},o&&u.createElement(u.Fragment,null,o.title&&u.createElement(ModalHeader,null,o.title),o.body&&u.createElement(ModalBody,null,o.body),o.footer&&u.createElement(ModalFooter,null,o.footer)))))},F=()=>{let t=useContext(ue);if(!t)throw new Error("useModalContext must be used within a ModalProvider");return t};var je=(t,o)=>{switch(o.type){case"ADD_EVENT":return {...t,events:[...t.events,o.payload]};case"REMOVE_EVENT":return {...t,events:t.events.filter(c=>c.id!==o.payload.id)};case"UPDATE_EVENT":return {...t,events:t.events.map(c=>c.id===o.payload.id?o.payload:c)};case"SET_EVENTS":return {...t,events:o.payload};default:return t}},ve=createContext(void 0),Ge=({children:t,onAddEvent:o,onUpdateEvent:c,onDeleteEvent:s,initialState:a,weekStartsOn:p="sunday",canEdit:l=y=>!0})=>{let[y,m]=useReducer(je,{events:a??[]});useEffect(()=>{a&&m({type:"SET_EVENTS",payload:a});},[a]);let k={getDaysInMonth:(d,i)=>Array.from({length:new Date(i,d+1,0).getDate()},(n,r)=>({day:r+1,events:[]})),getEventsForDay:(d,i)=>y?.events.filter(n=>{let r=new Date(n.startDate),g=new Date(n.endDate),v=new Date(i);v.setDate(d),v.setHours(0,0,0,0);let h=new Date(i);h.setDate(d+1),h.setHours(0,0,0,0);let T=r.getDate()===d&&r.getMonth()===i.getMonth()&&r.getFullYear()===i.getFullYear(),e=r<h&&g>=v;return T||e}),getDaysInWeek:(d,i)=>{let n=p==="sunday"?0:1,r=new Date(i,0,1),g=r.getDay(),v=new Date(r);v.setDate(r.getDate()+(d-1)*7+(n-g+7)%7);let h=[];for(let T=0;T<7;T++){let e=new Date(v);e.setDate(e.getDate()+T),h.push(e);}return h},getWeekNumber:d=>{let i=new Date(Date.UTC(d.getFullYear(),d.getMonth(),d.getDate()));i.setUTCDate(i.getUTCDate()+4-(i.getUTCDay()||7));let n=new Date(Date.UTC(i.getUTCFullYear(),0,1));return Math.ceil(((i.getTime()-n.getTime())/864e5+1)/7)},getDayName:d=>["Dom","Seg","Ter","Qua","Qui","Sex","S\xE1b"][d]};function V(d,i){let n=i.filter(e=>e.startDate<d.endDate&&e.endDate>d.startDate),r=n.length||1,g=n.indexOf(d),v=0,h=0,T=0;if(d.startDate instanceof Date&&d.endDate instanceof Date){let e=d.startDate.getHours()*60+d.startDate.getMinutes();v=(d.endDate.getHours()*60+d.endDate.getMinutes()-e)/60*64;let O=d.startDate.getHours()+d.startDate.getMinutes()/60;h=Math.max(0,(24-O)*64),v=Math.min(v,h),T=O*64;}else console.error("Invalid event or missing start/end dates.");return {height:`${v<10?20:v>h?h:v}px`,top:`${T}px`,zIndex:g+1,left:`${g*100/r}%`,maxWidth:`${100/r}%`,minWidth:`${100/r}%`}}function H(d){m({type:"ADD_EVENT",payload:d}),o&&o(d);}function S(d,i){m({type:"UPDATE_EVENT",payload:{...d,id:i}}),c&&c(d);}function $(d){m({type:"REMOVE_EVENT",payload:{id:d}}),s&&s(d);}let P={handleEventStyling:V,handleAddEvent:H,handleUpdateEvent:S,handleDeleteEvent:$};return u.createElement(ve.Provider,{value:{events:y,dispatch:m,getters:k,handlers:P,weekStartsOn:p,canEdit:l}},u.createElement(ce,null,t))},W=()=>{let t=useContext(ve);if(!t)throw new Error("useScheduler must be used within a SchedulerProvider");return t};function Q(t){return `${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}function fe(t){let{year:o,month:c,day:s}=t;return new Date(o,c-1,s)}function R({data:t,setValue:o,readOnly:c=!1}){let[s,a]=useState({startDate:t?parseDate(Q(t?.startDate)):parseDate("2024-04-06"),endDate:t?parseDate(Q(t?.endDate)):parseDate("2024-04-10"),startTime:new Time(t?.startDate?.getHours()||0,t?.startDate?.getMinutes()||0),endTime:new Time(t?.endDate?.getHours()||0,t?.endDate?.getMinutes()||0)});return useEffect(()=>{if(!s)return;let p=fe(s.startDate),l=fe(s.endDate);p.setHours(s?.startTime?.hour||0),p.setMinutes(s?.startTime?.minute||0),l.setHours(s?.endTime?.hour||0),l.setMinutes(s?.endTime?.minute||0),l<p&&l.setHours(p.getHours()+1),o("startDate",p),o("endDate",l);},[s,o]),u.createElement("div",{style:{pointerEvents:c?"none":"auto"}},u.createElement("div",{className:"w-full flex gap-4 max-w-full flex-wrap"},u.createElement(DateRangePicker,{label:"Dura\xE7\xE3o do Evento",isRequired:!0,isReadOnly:c,value:{start:s.startDate,end:s.endDate},className:"w-full",onChange:p=>{let l=p?.start,y=p?.end,m=new Date(l?.year||0,(l?.month||1)-1,l?.day||1),C=new Date(y?.year||0,(y?.month||1)-1,y?.day||1);a({...s,startDate:parseDate(Q(m)),endDate:parseDate(Q(C))});}}),u.createElement("div",{className:"flex flex-wrap gap-4 flex-row flex-grow"},u.createElement(TimeInput,{label:"Hora de In\xEDcio",defaultValue:s?.startTime,isReadOnly:c,className:"flex-1",onChange:p=>{a({...s,startTime:p||new Time(0,0)});}}),u.createElement(TimeInput,{label:"Hora de T\xE9rmino",defaultValue:s?.endTime,isReadOnly:c,className:"flex-1",onChange:p=>{a({...s,endTime:p||new Time(0,0)});},isInvalid:s?.startTime&&s?.endTime&&s.endTime.hour*60+s.endTime.minute<=s.startTime.hour*60+s.startTime.minute}))))}var Kt=["success","primary","default","warning","danger"],he=z$1.object({id:z$1.string().optional(),title:z$1.string().nonempty("Event name is required"),description:z$1.string().optional(),startDate:z$1.date(),endDate:z$1.date(),variant:z$1.enum(["primary","danger","success","warning","default"]),color:z$1.string().nonempty("Color selection is required"),event_type:z$1.string().optional(),productData:z$1.object({product_id:z$1.string().nonempty("Product ID is required"),product_title:z$1.string().nonempty("Product title is required"),learning_path_title:z$1.string().optional(),module_id:z$1.string().nonempty("Module ID is required"),module_title:z$1.string().nonempty("Module title is required")}).optional()});function z({CustomAddEventModal:t,productData:o,eventTypes:c}){let{onClose:s,data:a}=F(),{canEdit:p}=W(),l=!!a?.id&&!p(a?.id||""),[y,m]=useState(v(a?.variant||"primary")),[C,w]=useState(a?.productData?.product_id||""),[N,D]=useState(a?.productData?.learning_path_title||""),[A,k]=useState(a?.productData?.module_id||"");useEffect(()=>{a?.productData&&(w(a.productData.product_id||""),D(a.productData.learning_path_title||""),k(a.productData.module_id||""));},[a?.productData]);let V=o?.filter(e=>e.product_id===C).map(e=>e.learning_path_title).filter((e,M,I)=>e&&I.indexOf(e)===M),H=o?.filter(e=>e.product_id===C&&(!N||e.learning_path_title===N)).map(e=>({id:e.module_id,title:e.module_title})).filter((e,M,I)=>I.findIndex(O=>O.id===e.id)===M),S=o?.map(e=>({id:e.product_id,title:e.product_title})).filter((e,M,I)=>I.findIndex(O=>O.id===e.id)===M),{handlers:$}=W(),{register:P,handleSubmit:d,reset:i,formState:{errors:n},setValue:r}=useForm({resolver:zodResolver(he),defaultValues:{id:a?.id??v4(),title:a?.title??"",description:a?.description??"",startDate:a?.startDate??new Date,endDate:a?.endDate??(()=>{let e=new Date;return e.setHours(e.getHours()+1),e})(),variant:a?.variant??"primary",color:a?.color??"blue",productData:a?.productData,event_type:a?.event_type??""}});useEffect(()=>{a&&i({id:a.id,title:a.title,description:a.description||"",startDate:a.startDate,endDate:a.endDate,variant:a.variant||"primary",color:a.color||"blue",productData:a.productData,event_type:a.event_type||""});},[a,i]);let g=[{key:"blue",name:"Marrom"},{key:"red",name:"Vermelho"},{key:"green",name:"Verde"},{key:"yellow",name:"Amarelo"}];function v(e){switch(e){case"primary":return "blue";case"danger":return "red";case"success":return "green";case"warning":return "yellow";default:return "blue"}}function h(e){switch(e){case"blue":return "primary";case"red":return "danger";case"green":return "success";case"yellow":return "warning";default:return "default"}}return u.createElement("form",{className:"flex flex-col gap-3 max-h-[80vh] overflow-y-auto pr-2",onSubmit:d(e=>{let M=o?.find(U=>U.product_id===C&&(!N||U.learning_path_title===N)&&U.module_id===A),O={id:a?.id??v4(),title:e.title,startDate:e.startDate,endDate:e.endDate,variant:e.variant,description:e.description||"",event_type:e.event_type,productData:M?{id:M.product_id,title:M.product_title,product_id:M.product_id,product_title:M.product_title,learning_path_title:M.learning_path_title,module_id:M.module_id,module_title:M.module_title}:void 0};a?.id?$.handleUpdateEvent(O,a?.id):$.handleAddEvent(O),s();})},t?t({register:P,errors:n,readOnly:l,setValue:r,reset:i,onClose:s,eventTypes:c,uniqueProducts:S,data:a}):u.createElement(u.Fragment,null,l?u.createElement(u.Fragment,null):u.createElement(Input,{...P("title"),label:"Nome do Evento",placeholder:"Digite o nome do evento",variant:"flat",isReadOnly:l,isInvalid:!!n.title,errorMessage:n.title?.message}),l?u.createElement("div",{className:"w-full min-h-fit overflow-y-auto p-3 rounded-medium bg-default-100",dangerouslySetInnerHTML:{__html:a?.description||""}}):u.createElement(Textarea,{...P("description"),label:"Descri\xE7\xE3o do Evento",placeholder:"Digite a descri\xE7\xE3o do evento",variant:"flat"}),l?a?.event_type?u.createElement("div",{className:"flex flex-col gap-1"},u.createElement("span",{className:"text-sm text-default-700"},"Tipo do Evento"),u.createElement("div",{className:"w-full p-3 rounded-medium bg-default-100"},a?.event_type||"")):null:c&&c.length>0?u.createElement(Select,{...P("event_type"),label:"Tipo do Evento",placeholder:"Selecione o tipo do evento",variant:"flat",isInvalid:!!n.event_type,errorMessage:n.event_type?.message},(c||[]).map(e=>u.createElement(SelectItem,{key:e,value:e},e))):null,u.createElement(R,{data:a,setValue:r,readOnly:l}),S&&S.length>0&&u.createElement("div",{className:"flex flex-col gap-3"},l?C?u.createElement("div",{className:"flex flex-col gap-1"},u.createElement("span",{className:"text-sm text-default-700"},"Conte\xFAdo"),u.createElement("div",{className:"w-full p-3 rounded-medium bg-default-100"},S?.find(e=>e.id===C)?.title||"")):null:u.createElement(Select,{label:"Conte\xFAdo",placeholder:"Selecione um conte\xFAdo",value:C,variant:"flat",onChange:e=>{w(e.target.value),D(""),k("");}},(S||[]).map(e=>u.createElement(SelectItem,{key:e.id,value:e.id},e.title))),V&&V.length>0&&(l?u.createElement("div",{className:"flex flex-col gap-1"},u.createElement("span",{className:"text-sm text-default-700"},"Trilha"),u.createElement("div",{className:"w-full p-3 rounded-medium bg-default-100"},N||"")):u.createElement(Select,{label:"Trilha",placeholder:"Selecione uma trilha (opcional)",value:N,variant:"flat",onChange:e=>{D(e.target.value),k("");}},V.map(e=>u.createElement(SelectItem,{key:e,value:e},e)))),H&&H.length>0&&(l?u.createElement("div",{className:"flex flex-col gap-1"},u.createElement("span",{className:"text-sm text-default-700"},"M\xF3dulo"),u.createElement("div",{className:"w-full p-3 rounded-medium bg-default-100"},H.find(e=>e.id===A)?.title||"")):u.createElement(Select,{label:"M\xF3dulo",placeholder:"Selecione um m\xF3dulo",value:A,variant:"flat",onChange:e=>k(e.target.value)},H.map(e=>u.createElement(SelectItem,{key:e.id,value:e.id},e.title))))),!l&&u.createElement(Dropdown,{backdrop:"blur"},u.createElement(DropdownTrigger,null,u.createElement(Button,{variant:"flat",className:"justify-between w-fit my-4",color:h(y)},g.find(e=>e.key===y)?.name)),u.createElement(DropdownMenu,{"aria-label":"Color selection",variant:"flat",selectionMode:"single",selectedKeys:[y],onSelectionChange:e=>{let M=e.currentKey||"blue";m(M),i(I=>({...I,variant:h(M)}));}},g.map(e=>u.createElement(DropdownItem,{key:e.key,startContent:u.createElement("div",{className:`w-4 h-4 rounded-full bg-${e.key}-500`})},e.name)))),l&&u.createElement(ModalFooter,{className:"px-0"},u.createElement(Button,{color:"primary",variant:"flat",onPress:s},"Fechar")),!l&&u.createElement(ModalFooter,{className:"px-0"},u.createElement(Button,{color:"danger",variant:"light",onPress:s},"Cancelar"),u.createElement(Button,{color:"primary",type:"submit"},"Salvar Evento"))))}var we=t=>t.toLocaleString("pt-BR",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0});function Y({event:t,CustomEventModal:o}){let{showModal:c}=F(),{handlers:s}=W();function a(l){c({title:l?.title,body:u.createElement(z,{CustomAddEventModal:o?.CustomAddEventModal?.CustomForm,productData:o?.CustomAddEventModal?.ProductData,eventTypes:o?.CustomAddEventModal?.eventTypes}),getter:async()=>({...l})});}let p=l=>l?.replace(/<[^>]*>/g,"");return u.createElement(motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2,ease:"easeInOut"},key:t?.id,className:"w-full relative use-automation-zoom-in cursor-pointer border border-default-400/60 rounded-lg  flex flex-col flex-grow "},t?.canEdit&&u.createElement(Chip,{onClickCapture:l=>{l.stopPropagation(),s.handleDeleteEvent(t?.id);},color:"danger",variant:"solid",classNames:{content:"max-w-fit min-w-0 p-1"},className:"absolute z-50 right-0 top-[-5px]"},u.createElement(TrashIcon,{size:12})),t.CustomEventComponent?u.createElement("div",{onClickCapture:l=>{l.stopPropagation(),a({id:t?.id,title:t?.title,startDate:t?.startDate,endDate:t?.endDate,description:t?.description,variant:t?.variant});}},u.createElement(t.CustomEventComponent,{...t})):u.createElement(Chip,{onClickCapture:l=>{l.stopPropagation(),a({id:t?.id,title:t?.title,startDate:t?.startDate,endDate:t?.endDate,description:t?.description,variant:t?.variant});},variant:"flat",color:t?.variant,classNames:{content:"p-0"},className:`min-w-full items-start p-0 flex-grow flex-col flex ${t?.minmized?"h-full":"min-h-fit p-1"} rounded-md`},u.createElement("div",{className:`flex ${t?.minmized?"p-0":"p-1"} flex-col flex-grow px-1 rounded-md  items-start w-full`},u.createElement("h1",{className:`${t?.minmized&&"text-[0.7rem] p-0 px-1"} font-semibold line-clamp-1 break-all whitespace-pre-wrap`},p(t?.title)),u.createElement("p",{className:"text-[0.65rem] break-all whitespace-pre-wrap line-clamp-3"},p(t?.description||"")),!t?.minmized&&u.createElement("div",{className:"flex justify-between w-full"},u.createElement("p",{className:"text-sm"},we(t?.startDate)),u.createElement("p",{className:"text-sm"},"-"),u.createElement("p",{className:"text-sm"},we(t?.endDate))))))}var mt=Array.from({length:24},(t,o)=>`${o.toString().padStart(2,"0")}:00`),ut={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},ct={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.3}}};function te({prevButton:t,nextButton:o,CustomEventComponent:c,CustomEventModal:s,classNames:a}){let p=useRef(null),[l,y]=useState(null),[m,C]=useState(0),[w,N]=useState(new Date),{showModal:D}=F(),{getters:A,handlers:k}=W(),V=n=>{if(!p.current)return;let r=p.current.getBoundingClientRect(),g=n.clientY-r.top,v=r.height/24,h=Math.max(0,Math.min(23,Math.floor(g/v))),T=g%v/v,e=Math.floor(T*60);y(`${h.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`),C(g);},H=()=>w.toLocaleDateString("pt-BR",{weekday:"short",day:"numeric",month:"short",year:"numeric"}),S=A.getEventsForDay(w?.getDate()||0,w);function $(n){D({title:s?.CustomAddEventModal?.title||"Adicionar Evento",body:u.createElement(z,{CustomAddEventModal:s?.CustomAddEventModal?.CustomForm,productData:s?.CustomAddEventModal?.ProductData,eventTypes:s?.CustomAddEventModal?.eventTypes}),getter:async()=>{let r=n?.startDate||new Date,g=n?.endDate||new Date;return {startDate:r,endDate:g}}});}function P(n){if(!n){console.error("Detailed hour not provided.");return}let[r,g]=n.split(":").map(Number),v=w.getDate();if(v<1||v>31){console.error("Invalid day selected:",v);return}let h=new Date(w.getFullYear(),w.getMonth(),v,r,g);$({startDate:h,endDate:new Date(h.getTime()+60*60*1e3),title:"",id:"",variant:"primary"});}let d=()=>{let n=new Date(w);n.setDate(w.getDate()+1),N(n);},i=()=>{let n=new Date(w);n.setDate(w.getDate()-1),N(n);};return u.createElement("div",{className:""},u.createElement("div",{className:"flex justify-between gap-3 flex-wrap mb-5"},u.createElement("h1",{className:"text-3xl font-semibold mb-4"},H()),u.createElement("div",{className:"flex ml-auto  gap-3"},t?u.createElement("div",{onClick:i},t):u.createElement(Button,{className:a?.prev,startContent:u.createElement(ArrowLeft,null),onClick:i},"Anterior"),o?u.createElement("div",{onClick:d},o):u.createElement(Button,{className:a?.next,onClick:d,endContent:u.createElement(ArrowRight,null)},"Pr\xF3ximo"))),u.createElement("div",{className:"flex flex-col gap-4"},u.createElement("div",{className:"all-day-events"},u.createElement(AnimatePresence,{mode:"wait"},S&&S?.length?S?.map((n,r)=>u.createElement("div",{key:`event-${n.id}-${r}`,className:"mb-2"},u.createElement(Y,{event:{...n,CustomEventComponent:c,minmized:!1},CustomEventModal:s}))):"Nenhum evento para hoje")),u.createElement("div",{className:"relative rounded-md bg-default-50 hover:bg-default-100 transition duration-400"},u.createElement(motion.div,{className:"relative rounded-xl flex ease-in-out",ref:p,variants:ut,initial:"hidden",animate:"visible",onMouseMove:V,onMouseLeave:()=>y(null)},u.createElement("div",{className:"flex  flex-col"},mt.map((n,r)=>u.createElement(motion.div,{key:`hour-${r}`,variants:ct,className:"cursor-pointer   transition duration-300  p-4 h-[64px] text-left text-sm text-muted-foreground border-default-200"},n))),u.createElement("div",{className:"flex relative flex-grow flex-col "},Array.from({length:24}).map((n,r)=>u.createElement("div",{onClick:()=>{P(l);},key:`hour-${r}`,className:"cursor-pointer w-full relative border-b  hover:bg-default-200/50  transition duration-300  p-4 h-[64px] text-left text-sm text-muted-foreground border-default-200"},u.createElement("div",{className:"absolute bg-default-200 flex items-center justify-center text-xs opacity-0 transition left-0 top-0 duration-250 hover:opacity-100 w-full h-full"},"Adicionar Evento"))),u.createElement(AnimatePresence,{mode:"wait"},S&&S?.length?S?.map((n,r)=>{let{height:g,left:v,maxWidth:h,minWidth:T,top:e,zIndex:M}=k.handleEventStyling(n,S);return u.createElement("div",{key:`event-${n.id}-${r}`,style:{minHeight:g,top:e,left:v,maxWidth:h,minWidth:T},className:"flex transition-all duration-1000 flex-grow flex-col z-50 absolute"},u.createElement(Y,{event:{...n,CustomEventComponent:c,minmized:!0},CustomEventModal:s}))}):""))),l&&u.createElement("div",{className:"absolute left-[50px] w-[calc(100%-53px)] h-[3px]  bg-primary-300 dark:bg-primary/30 rounded-full pointer-events-none",style:{top:`${m}px`}},u.createElement(Chip,{color:"success",variant:"flat",className:"absolute vertical-abs-center z-50 left-[-55px] text-xs uppercase"},l)))))}function ne(){let{data:t}=F(),o=t?.dayEvents||[];return u.createElement("div",{className:"flex flex-col gap-2"},o.map(c=>u.createElement(Y,{key:c.id,event:{...c}})))}function ae({prevButton:t,nextButton:o,CustomEventComponent:c,CustomEventModal:s,classNames:a}){let{getters:p,weekStartsOn:l}=W(),{showModal:y}=F(),[m,C]=useState(new Date),w=p.getDaysInMonth(m.getMonth(),m.getFullYear()),N=()=>{let n=new Date(m.getFullYear(),m.getMonth()-1,1);C(n);},D=()=>{let n=new Date(m.getFullYear(),m.getMonth()+1,1);C(n);};function A(n){y({title:"Adicionar Evento",body:u.createElement(z,null),getter:async()=>{let r=new Date(m.getFullYear(),m.getMonth(),n??1,0,0,0,0),g=new Date(m.getFullYear(),m.getMonth(),n??1,23,59,59,999);return {startDate:r,endDate:g}}});}function k(n){y({title:n?.[0]?.startDate.toLocaleDateString("pt-BR",{weekday:"short",day:"numeric",month:"short",year:"numeric"}),body:u.createElement(ne,null),getter:async()=>({dayEvents:n})});}let V={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.02}}},H={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.3}}},S=l==="monday"?["Seg","Ter","Qua","Qui","Sex","S\xE1b","Dom"]:["Dom","Seg","Ter","Qua","Qui","Sex","S\xE1b"],P=(new Date(m.getFullYear(),m.getMonth(),1).getDay()-(l==="monday"?1:0)+7)%7,d=new Date(m.getFullYear(),m.getMonth()-1,1),i=new Date(d.getFullYear(),d.getMonth()+1,0).getDate();return u.createElement("div",null,u.createElement("div",{className:"flex flex-col mb-4"},u.createElement(motion.h2,{key:m.getMonth(),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:1},className:"text-lg my-5 tracking-tighter font-bold"},m.toLocaleString("default",{month:"long"})," ",m.getFullYear()),u.createElement("div",{className:"flex gap-3"},t?u.createElement("div",{onClick:N},t):u.createElement(Button,{className:a?.prev,startContent:u.createElement(ArrowLeft,null),onClick:N},"Anterior"),o?u.createElement("div",{onClick:D},o):u.createElement(Button,{className:a?.next,onClick:D,endContent:u.createElement(ArrowRight,null)},"Pr\xF3ximo"))),u.createElement(AnimatePresence,{mode:"wait"},u.createElement(motion.div,{variants:V,initial:"hidden",animate:"visible",key:m.getMonth(),className:"grid grid-cols-7 gap-1 sm:gap-2"},S.map((n,r)=>u.createElement("div",{key:r,className:"text-left my-8 text-2xl tracking-tighter font-medium"},n)),Array.from({length:P}).map((n,r)=>u.createElement("div",{key:`offset-${r}`,className:"h-[150px] opacity-50"},u.createElement("div",{className:ke("font-semibold relative text-lg mb-1")},i-P+r+1))),w.map(n=>{let r=p.getEventsForDay(n.day,m);return u.createElement(motion.div,{className:"hover:z-50 border-none h-[150px] rounded group flex flex-col",key:n.day,variants:H},u.createElement(Card,{isPressable:!0,className:"shadow-md  relative flex p-4 border border-default-100 h-full",onClick:()=>A(n.day)},u.createElement("div",{className:ke("font-semibold relative text-lg mb-1",r.length>0?"text-primary-600":"text-muted-foreground",new Date().getDate()===n.day&&new Date().getMonth()===m.getMonth()&&new Date().getFullYear()===m.getFullYear()?"text-secondary-500":"")},n.day),u.createElement("div",{className:"flex-grow flex flex-col gap-2 w-full overflow-hidden"},u.createElement(AnimatePresence,{mode:"wait"},r?.length>0&&u.createElement(Y,{event:{...r[0],CustomEventComponent:c,minmized:!0},CustomEventModal:s})),r.length>1&&u.createElement(Chip,{onClick:g=>{g.stopPropagation(),k(r);},variant:"flat",className:"hover:bg-default-200 absolute right-2 text-xs top-2 transition duration-300"},r.length>1?`+${r.length-1}`:" ")),r.length===0&&u.createElement("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300"},u.createElement("span",{className:"text-white tracking-tighter text-lg font-semibold"},"Adicionar Evento"))))}))))}var Mt=Array.from({length:24},(t,o)=>`${o.toString().padStart(2,"0")}:00`);var Nt={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}};function ie({prevButton:t,nextButton:o,CustomEventComponent:c,CustomEventModal:s,classNames:a}){let{getters:p,handlers:l}=W(),y=useRef(null),[m,C]=useState(null),[w,N]=useState(0),[D,A]=useState(new Date),{showModal:k}=F(),V=p?.getDaysInWeek(p?.getWeekNumber(D),D.getFullYear()),H=i=>{if(!y.current)return;let n=y.current.getBoundingClientRect(),r=i.clientY-n.top,g=n.height/24,v=Math.max(0,Math.min(23,Math.floor(r/g))),h=r%g/g,T=Math.floor(h*60);C(`${v.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}`),N(r+83);};function S(i){k({title:"Adicionar Evento",body:u.createElement(z,null),getter:async()=>{let n=i?.startDate||new Date,r=i?.endDate||new Date;return {startDate:n,endDate:r}}});}let $=()=>{let i=new Date(D);i.setDate(D.getDate()+7),A(i);},P=()=>{let i=new Date(D);i.setDate(D.getDate()-7),A(i);};function d(i,n){if(!n){console.error("Detailed hour not provided.");return}let[r,g]=n.split(":").map(Number),v=V[i%7].getDate();if(v<1||v>31){console.error("Invalid day selected:",v);return}let h=new Date(D.getFullYear(),D.getMonth(),v,r,g);S({startDate:h,endDate:new Date(h.getTime()+60*60*1e3),title:"",id:"",variant:"primary"});}return u.createElement("div",{className:"flex flex-col gap-4"},u.createElement(motion.div,{key:D.toDateString()+"parent",className:"all-week-events flex flex-col gap-2",variants:Nt,initial:"hidden",animate:"visible"}),u.createElement("div",{className:"flex ml-auto gap-3"},t?u.createElement("div",{onClick:P},t):u.createElement(Button,{className:a?.prev,startContent:u.createElement(ArrowLeft,null),onClick:P},"Anterior"),o?u.createElement("div",{onClick:$},o):u.createElement(Button,{className:a?.next,onClick:$,endContent:u.createElement(ArrowRight,null)},"Pr\xF3ximo")),u.createElement("div",{key:D.toDateString(),className:"grid use-automation-zoom-in grid-cols-8 gap-0"},u.createElement("div",{className:"sticky top-0 left-0 z-30 bg-default-100 rounded-tl-lg h-full border-0  flex items-center justify-center"},u.createElement("span",{className:"text-lg font-semibold text-muted-foreground px-4"},"Semana ",p.getWeekNumber(D))),u.createElement("div",{className:"col-span-7 flex flex-col relative"},u.createElement("div",{className:"grid grid-cols-7 gap-0 flex-grow"},V.map((i,n)=>u.createElement("div",{key:n,className:"relative flex flex-col"},u.createElement("div",{className:"sticky bg-default-100 top-0 z-20 flex-grow flex items-center justify-center"},u.createElement("div",{className:"text-center p-4"},u.createElement("div",{className:"text-lg font-semibold"},p.getDayName(i.getDay())),u.createElement("div",{className:ke("text-lg font-semibold",new Date().getDate()===i.getDate()&&new Date().getMonth()===D.getMonth()&&new Date().getFullYear()===D.getFullYear()?"text-secondary-500":"")},i.getDate()))),u.createElement("div",{className:"absolute top-12 right-0 w-px h-[calc(100%-3rem)]"})))),m&&u.createElement("div",{className:"absolute flex z-10 left-0 w-full h-[3px] bg-primary-300 dark:bg-primary/30 rounded-full pointer-events-none",style:{top:`${w}px`}},u.createElement(Chip,{color:"success",variant:"flat",className:"absolute vertical-abs-center z-50 left-[-55px] text-xs uppercase"},m))),u.createElement("div",{ref:y,onMouseMove:H,onMouseLeave:()=>C(null),className:"relative grid grid-cols-8 col-span-8"},u.createElement("div",{className:"col-span-1 bg-default-50 hover:bg-default-100 transition duration-400"},Mt.map((i,n)=>u.createElement("div",{key:`hour-${n}`,className:"cursor-pointer border-b border-default-200 p-[16px] h-[64px] text-center text-sm text-muted-foreground border-r"},i))),u.createElement("div",{className:"col-span-7 bg-default-50 grid h-full grid-cols-7"},Array.from({length:7},(i,n)=>{let r=p.getEventsForDay(V[n%7].getDate(),D);return u.createElement("div",{key:`day-${n}`,className:"col-span-1  border-default-200 z-20 relative transition duration-300 cursor-pointer border-r border-b text-center text-sm text-muted-foreground",onClick:()=>{d(n,m);}},u.createElement(AnimatePresence,{mode:"wait"},r?.map((g,v)=>{let{height:h,left:T,maxWidth:e,minWidth:M,top:I,zIndex:O}=l.handleEventStyling(g,r);return u.createElement("div",{key:`event-${g.id}-${v}`,style:{minHeight:h,height:h,top:I,left:T,maxWidth:e,minWidth:M},className:"flex transitio transition-all duration-1000 flex-grow flex-col z-50 absolute"},u.createElement(Y,{event:{...g,CustomEventComponent:c,minmized:!0},CustomEventModal:s}))})),Array.from({length:24},(g,v)=>u.createElement("div",{key:`day-${n}-hour-${v}`,className:"col-span-1 border-default-200 h-16 z-20 relative transition duration-300 cursor-pointer border-r border-b text-center text-sm text-muted-foreground"},u.createElement("div",{className:"absolute bg-default-100 flex items-center justify-center text-xs opacity-0 transition duration-250 hover:opacity-100 w-full h-full"},"Adicionar Evento"))))})))))}var de={initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3,type:"spring",stiffness:250}};function Pe({views:t={views:["day","week","month"],mobileViews:["day"]},CustomComponents:o,classNames:c}){let{showModal:s}=F(),[a,p]=u.useState(!1);useEffect(()=>{p(!0);},[]);let[l,y]=u.useState(a?window.innerWidth<=768:!1);useEffect(()=>{if(!a)return;y(window.innerWidth<=768);function w(){window&&window.innerWidth<=768?y(!0):y(!1);}return window&&window.addEventListener("resize",w),()=>window&&window.removeEventListener("resize",w)},[a]);function m(w){s({title:o?.CustomEventModal?.CustomAddEventModal?.title||"Adicionar Evento",body:u.createElement(z,{CustomAddEventModal:o?.CustomEventModal?.CustomAddEventModal?.CustomForm,productData:o?.CustomEventModal?.CustomAddEventModal?.ProductData,eventTypes:o?.CustomEventModal?.CustomAddEventModal?.eventTypes}),getter:async()=>{let N=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate(),0,0,0,0),D=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate(),23,59,59,999);return {startDate:N,endDate:D}}});}let C=l?t?.mobileViews:t?.views;return u.createElement("div",{className:"flex w-full flex-col"},u.createElement("div",{className:"flex w-full"},u.createElement("div",{className:"dayly-weekly-monthly-selection relative w-full"},u.createElement(Tabs,{classNames:{...c?.tabs},"aria-label":"Options",color:"primary",variant:"solid"},C?.includes("day")&&u.createElement(Tab,{key:"day",title:o?.customTabs?.CustomDayTab?o.customTabs.CustomDayTab:u.createElement("div",{className:"flex items-center space-x-2"},u.createElement(CalendarDaysIcon,{size:15}),u.createElement("span",null,"Dia"))},u.createElement(motion.div,{...de},u.createElement(te,{classNames:c?.buttons,prevButton:o?.customButtons?.CustomPrevButton,nextButton:o?.customButtons?.CustomNextButton,CustomEventComponent:o?.CustomEventComponent,CustomEventModal:o?.CustomEventModal}))),C?.includes("week")&&u.createElement(Tab,{key:"week",title:o?.customTabs?.CustomWeekTab?o.customTabs.CustomWeekTab:u.createElement("div",{className:"flex items-center space-x-2"},u.createElement(BsCalendarWeek,null),u.createElement("span",null,"Semana"))},u.createElement(motion.div,{...de},u.createElement(ie,{classNames:c?.buttons,prevButton:o?.customButtons?.CustomPrevButton,nextButton:o?.customButtons?.CustomNextButton,CustomEventComponent:o?.CustomEventComponent,CustomEventModal:o?.CustomEventModal}))),C?.includes("month")&&u.createElement(Tab,{key:"month",title:o?.customTabs?.CustomMonthTab?o.customTabs.CustomMonthTab:u.createElement("div",{className:"flex items-center space-x-2"},u.createElement(BsCalendarMonth,null),u.createElement("span",null,"M\xEAs"))},u.createElement(motion.div,{...de},u.createElement(ae,{classNames:c?.buttons,prevButton:o?.customButtons?.CustomPrevButton,nextButton:o?.customButtons?.CustomNextButton,CustomEventComponent:o?.CustomEventComponent,CustomEventModal:o?.CustomEventModal})))),o?.customButtons?.CustomAddEventButton?u.createElement("div",{onClick:()=>m(),className:"absolute top-0 right-0"},o?.customButtons.CustomAddEventButton):u.createElement(Button,{onClick:()=>m(),className:"absolute top-0 right-0 "+c?.buttons?.addEvent,color:"primary",startContent:u.createElement(Calendar,null)},"Adicionar Evento"))))}export{Pe as SchedularView,Ge as SchedulerProvider,he as eventSchema,W as useScheduler,Kt as variants};